# 高层RPC服务接口

## 3. 高层运动服务接口

高层运动服务接口的主要功能为机器人整机控制和上肢控制。

整机控制可以控制机器人的模式切换与移动，提供 RPC 接口；

上肢控制可以在运行机器人内置移动控制器的同时，单独控制上肢电机完成操作任务，提供 DDS 接口。

### 3.1 高层整机控制 rpc 接口

| **接口名称** | **GetFsmId** |
| --- | --- |
| 接口定义 | RpcErrorCode GetFsmId(int32\_t &fsm\_id); |
| 功能概述 | 获取当前状态机id。 |
| 参数 | fsm\_id：获取到的当前状态机id。 |
| 返回值 | 调用成功返回  0，否则返回相关错误码，详见错误码章节。 |
| 备注 | 状态机id详见状态机id章节。 |

| **接口名称** | **SetFsmId** |
| --- | --- |
| 接口定义 | RpcErrorCode SetFsmId(int32\_t fsm\_id); |
| 功能概述 | 设置状态机id。 |
| 参数 | fsm\_id：目标状态机id。 |
| 返回值 | 调用成功返回  0，否则返回相关错误码，详见错误码章节。 |
| 备注 | 状态机id详见状态机id章节。 |

| **接口名称** | **SwitchUpperLimbControl** |
| --- | --- |
| 接口定义 | RpcErrorCode SwitchUpperLimbControl(bool is\_on); |
| 功能概述 | 切换上肢控制权。 |
| 参数 | is\_on：true表示将上肢控制权切换为接口控制，false表示关闭切换，回到主运控整机控制。 |
| 返回值 | 调用成功返回  0，否则返回相关错误码，详见错误码章节。 |
| 备注 | 1、只允许在“预备”等位置控制状态、行走状态下开启切换；2、在进入不允许切换的状态后，会自动关闭切换。 |

| **接口名称** | **SetVel** |
| --- | --- |
| 接口定义 | RpcErrorCode SetVel(float vx, float vy, float vyaw, float duration = 1.0); |
| 功能概述 | 设置速度指令。 |
| 参数 | vx：前后运动速度，向前为正，单位m/s；<br>vy：左右运动速度，向左为正，单位m/s；<br>vyaw: 旋转速度，向逆时针为正，单位rad/s；<br>duration：速度指令持续时间，超时后停止，单位s。 |
| 返回值 | 调用成功返回  0，否则返回相关错误码，详见错误码章节。 |
| 备注 | 1、底层会自动将设置参数限幅至合理范围；2、遥控器指令优先级更高；3、整机停止运动：将速度指令置零SetVel( 0,  0,  0) 。 |

### 3.2 错误码（RpcErrorCode）

| **ID** | **说明** |
| --- | --- |
| 0 | 没有错误 |
| 1 | socket创建失败 |
| 2 | 通信连接失败 |
| 3 | 读取响应失败 |
| 4 | 响应数据解析失败 |
| 5 | 响应数据格式错误 |
| 6 | 服务端内部错误 |
| 100 | 非法的状态跳转请求，请在允许状态下调用 |
| 101 | 非法的切换上肢控制权请求，请在允许状态下调用 |
| 102 | 非法的设置速度指令请求，请在允许状态下调用 |