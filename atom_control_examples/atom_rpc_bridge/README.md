# Atom RPC Bridge

[![ROS2](https://img.shields.io/badge/ROS2-Humble-blue.svg)](https://docs.ros.org/en/humble/)
[![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)](#)

ğŸ¤– **Atomæœºå™¨äººRPCåˆ°DDSä¸­é—´å±‚æ¡¥æ¥åŒ…**

## ğŸ“– æ¦‚è¿°

`atom_rpc_bridge` æ˜¯ä¸€ä¸ªä¸“ä¸ºAtomæœºå™¨äººè®¾è®¡çš„ROS2åŒ…ï¼Œæä¾›äº†ä»ä¼ ç»ŸRPCæ¥å£åˆ°ROS2 DDSé€šä¿¡çš„æ— ç¼æ¡¥æ¥ã€‚è¯¥åŒ…å®ç°äº†ç‹¬ç«‹çš„RPCå®¢æˆ·ç«¯ï¼Œæ— éœ€ä¾èµ–å¤–éƒ¨ `atom_sdk`åº“ï¼Œå¯ä»¥åœ¨ä»»ä½•æ”¯æŒROS2çš„ç¯å¢ƒä¸‹ç‹¬ç«‹ç¼–è¯‘å’Œè¿è¡Œã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ”— **ç‹¬ç«‹RPCå®¢æˆ·ç«¯**: ä¸ä¾èµ–å¤–éƒ¨SDKï¼Œå®Œå…¨è‡ªåŒ…å«
- ğŸš€ **ROS2åŸç”Ÿæ”¯æŒ**: å®Œå…¨å…¼å®¹ROS2 DDSé€šä¿¡æœºåˆ¶
- ğŸ¯ **APIå…¼å®¹æ€§**: ä¿æŒä¸åŸRPCæ¥å£çš„å…¼å®¹æ€§
- ğŸ›¡ï¸ **çº¿ç¨‹å®‰å…¨**: æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è®¿é—®
- ğŸ“Š **å®æ—¶çŠ¶æ€ç›‘æ§**: æä¾›è¿æ¥çŠ¶æ€å’Œé”™è¯¯ç åé¦ˆ
- ğŸ”§ **æ˜“äºé›†æˆ**: ç®€å•çš„C++ APIæ¥å£

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ROS2 åº”ç”¨     â”‚â—„â”€â”€â–ºâ”‚  AtomDdsClient   â”‚â—„â”€â”€â–ºâ”‚ StandaloneRpc   â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚     Client      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–²                        â–²
                                â”‚                        â”‚
                                â–¼                        â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚   ROS2 Topics   â”‚    â”‚   RPC Server    â”‚
                       â”‚   & Services    â”‚    â”‚ (192.168.8.234) â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¾èµ–è¦æ±‚

- ROS2 Humbleç‰ˆæœ¬

### ç¼–è¯‘å®‰è£…

```bash
# ç¼–è¯‘
colcon build

# è®¾ç½®ç¯å¢ƒ
source install/setup.bash
```

### åŸºæœ¬ä½¿ç”¨

```cpp
#include "atom_rpc_bridge/atom_dds_client.hpp"

using namespace atom_rpc_bridge;

int main() {
    // åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹
    AtomDdsClient robot("my_robot_node");
  
    // åˆå§‹åŒ–
    if (!robot.initialize()) {
        return -1;
    }
  
    // è®¾ç½®FSMçŠ¶æ€
    robot.SetFsmId(1);  // é˜»å°¼æ¨¡å¼
  
    // æ§åˆ¶æœºå™¨äººè¿åŠ¨
    robot.SetVel(0.1f, 0.0f, 0.0f);  // å‰è¿›
  
    // å¯ç”¨ä¸Šè‚¢æ§åˆ¶
    robot.SwitchUpperLimbControl(true);
  
    return 0;
}
```

## ğŸ“š APIå‚è€ƒ

### AtomDdsClient ç±»

#### æ„é€ å‡½æ•°

```cpp
AtomDdsClient(const std::string& node_name, 
              const std::string& rpc_ip = "192.168.8.234", 
              int rpc_port = 51234);
```

#### ä¸»è¦æ–¹æ³•

| æ–¹æ³•                                       | æè¿°         | è¿”å›å€¼               |
| ------------------------------------------ | ------------ | -------------------- |
| `initialize()`                           | åˆå§‹åŒ–å®¢æˆ·ç«¯ | `bool`             |
| `IsConnected()`                          | æ£€æŸ¥è¿æ¥çŠ¶æ€ | `bool`             |
| `SetFsmId(uint32_t fsm_id)`              | è®¾ç½®FSMçŠ¶æ€  | `AtomRpcErrorCode` |
| `GetFsmId(uint32_t& fsm_id)`             | è·å–FSMçŠ¶æ€  | `AtomRpcErrorCode` |
| `SetVel(float vx, float vy, float vyaw)` | è®¾ç½®é€Ÿåº¦å‘½ä»¤ | `AtomRpcErrorCode` |
| `SwitchUpperLimbControl(bool enable)`    | ä¸Šè‚¢æ§åˆ¶å¼€å…³ | `AtomRpcErrorCode` |

### é”™è¯¯ç å®šä¹‰

```cpp
enum class AtomRpcErrorCode {
    SUCCESS = 0,           // æˆåŠŸ
    CONNECTION_FAILED,     // è¿æ¥å¤±è´¥
    TIMEOUT,              // è¶…æ—¶
    INVALID_PARAMS,       // å‚æ•°æ— æ•ˆ
    RPC_ERROR,            // RPCé”™è¯¯
    UNKNOWN_ERROR         // æœªçŸ¥é”™è¯¯
};
```

## ğŸ”Œ ROS2æ¥å£

### å‘å¸ƒçš„è¯é¢˜

| è¯é¢˜å                   | æ¶ˆæ¯ç±»å‹                | æè¿°         |
| ------------------------ | ----------------------- | ------------ |
| `/atom/fsm_cmd`        | `std_msgs/UInt32`     | FSMçŠ¶æ€å‘½ä»¤  |
| `/atom/velocity_cmd`   | `geometry_msgs/Twist` | é€Ÿåº¦æ§åˆ¶å‘½ä»¤ |
| `/atom/upper_limb_cmd` | `std_msgs/Bool`       | ä¸Šè‚¢æ§åˆ¶å‘½ä»¤ |

### è®¢é˜…çš„è¯é¢˜

| è¯é¢˜å                      | æ¶ˆæ¯ç±»å‹            | æè¿°        |
| --------------------------- | ------------------- | ----------- |
| `/atom/fsm_state`         | `std_msgs/UInt32` | å½“å‰FSMçŠ¶æ€ |
| `/atom/connection_status` | `std_msgs/Bool`   | è¿æ¥çŠ¶æ€    |

### æä¾›çš„æœåŠ¡

| æœåŠ¡å                  | æœåŠ¡ç±»å‹             | æè¿°        |
| ----------------------- | -------------------- | ----------- |
| `/atom/get_fsm_state` | `std_srvs/Trigger` | è·å–FSMçŠ¶æ€ |
| `/atom/reconnect`     | `std_srvs/Trigger` | é‡æ–°è¿æ¥RPC |

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### è¿è¡Œæµ‹è¯•ç¨‹åº

```bash
# å¯åŠ¨æµ‹è¯•èŠ‚ç‚¹
ros2 launch atom_rpc_bridge atom_dds_test.launch.py

# æˆ–ç›´æ¥è¿è¡Œ
ros2 run atom_rpc_bridge atom_dds_test
```

### è‡ªå®šä¹‰RPCæœåŠ¡å™¨åœ°å€

```bash
ros2 launch atom_rpc_bridge atom_dds_test.launch.py rpc_ip:=192.168.1.100 rpc_port:=8080
```

### åœ¨ä»£ç ä¸­ä½¿ç”¨

æŸ¥çœ‹ `examples/simple_usage_example.cpp` è·å–å®Œæ•´ç¤ºä¾‹ã€‚

## ğŸ”§ FSMçŠ¶æ€å‚è€ƒ

| FSM ID | çŠ¶æ€åç§°       | æè¿°     |
| ------ | -------------- | -------- |
| 0      | PASSIVE        | è¢«åŠ¨æ¨¡å¼ |
| 1      | DAMPING        | é˜»å°¼æ¨¡å¼ |
| 2      | RECOVERY_STAND | æ¢å¤ç«™ç«‹ |
| 3      | LOCOMOTION     | è¿åŠ¨æ¨¡å¼ |
| 4      | BALANCE_STAND  | å¹³è¡¡ç«™ç«‹ |

## ğŸ› è°ƒè¯•å’Œæ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**

   ```bash
   # æ£€æŸ¥ç½‘ç»œè¿æ¥
   ping 192.168.8.234

   # æ£€æŸ¥ç«¯å£æ˜¯å¦å¼€æ”¾
   telnet 192.168.8.234 51234
   ```
2. **ç¼–è¯‘é”™è¯¯**

   ```bash
   # ç¡®ä¿ä¾èµ–å·²å®‰è£…
   rosdep install --from-paths src --ignore-src -r -y
   ```
3. **è¿è¡Œæ—¶é”™è¯¯**

   ```bash
   # å¯ç”¨è°ƒè¯•æ—¥å¿—
   ros2 launch atom_rpc_bridge atom_dds_test.launch.py log_level:=debug
   ```

### æ—¥å¿—çº§åˆ«

è®¾ç½®ç¯å¢ƒå˜é‡å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
export RCUTILS_LOGGING_SEVERITY=DEBUG
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **è¿æ¥æ± **: å¤ç”¨RPCè¿æ¥å‡å°‘å¼€é”€
- **å¼‚æ­¥å¤„ç†**: éé˜»å¡çš„RPCè°ƒç”¨
- **ç¼“å­˜æœºåˆ¶**: å‡å°‘é‡å¤çš„çŠ¶æ€æŸ¥è¯¢
- **çº¿ç¨‹ä¼˜åŒ–**: åˆç†çš„çº¿ç¨‹æ± é…ç½®

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-09-02)

- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ”§ ç‹¬ç«‹RPCå®¢æˆ·ç«¯å®ç°
- ğŸ“š å®Œæ•´çš„APIæ–‡æ¡£
- ğŸ§ª æµ‹è¯•ç”¨ä¾‹å’Œç¤ºä¾‹
